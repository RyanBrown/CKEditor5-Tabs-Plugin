<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Overlay Panel</title>

    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .overlay-panel {
            box-shadow: 0 0.1875rem 0.5rem rgba(0, 0, 0, 0.15);
            background: #fff;
            border-radius: 5px;
            border: 1px solid transparent;
            display: none;
            min-width: 200px;
            padding: 0;
            position: absolute;
            z-index: 1000;
        }

        .overlay-panel.active {
            display: block;
        }

        .overlay-panel header {
            border-bottom: 1px solid #ccc;
            display: flex;
            justify-content: space-between;
            padding: 1.5rem;
        }

        .overlay-panel main {
            padding: 1.5rem;
        }

        .overlay-panel footer {
            border-top: 1px solid #ccc;
            display: flex;
            justify-content: flex-start;
            padding: 1.5rem;
        }
    </style>
</head>

<body>

    <!-- Buttons with their respective panels -->
    <button class="triggerBtn" data-id="1" style="position: absolute; left: 10px; top: 10px;">Open Overlay</button>
    <div class="overlay-panel" data-id="1">
        <header>Title <button class="closeBtn">Close</button></header>
        <main>
            <p>Panel positioned dynamically.</p>
        </main>
        <footer><button class="closeBtn">Close</button></footer>
    </div>

    <button class="triggerBtn" data-id="2" style="position: absolute; right: 10px; top: 10px;">Open Overlay</button>
    <div class="overlay-panel" data-id="2">
        <header>Title <button class="closeBtn">Close</button></header>
        <main>
            <p>Panel positioned dynamically.</p>
        </main>
        <footer><button class="closeBtn">Close</button></footer>
    </div>

    <button class="triggerBtn" data-id="3" style="position: absolute; left: 10px; bottom: 10px;">Open Overlay</button>
    <div class="overlay-panel" data-id="3">
        <header>Title <button class="closeBtn">Close</button></header>
        <main>
            <p>Panel positioned dynamically.</p>
        </main>
        <footer><button class="closeBtn">Close</button></footer>
    </div>

    <button class="triggerBtn" data-id="4" style="position: absolute; right: 10px; bottom: 10px;">Open Overlay</button>
    <div class="overlay-panel" data-id="4">
        <header>Title <button class="closeBtn">Close</button></header>
        <main>
            <p>Panel positioned dynamically.</p>
        </main>
        <footer><button class="closeBtn">Close</button></footer>
    </div>

    <script>
        class OverlayPanel {
            constructor() {
                this.buttons = document.querySelectorAll(".triggerBtn");
                this.panels = document.querySelectorAll(".overlay-panel");

                this.buttons.forEach(button => {
                    button.addEventListener("click", (event) => this.toggle(event));
                });

                document.addEventListener("click", (event) => this.handleClickOutside(event));
                document.querySelectorAll(".closeBtn").forEach(closeBtn => {
                    closeBtn.addEventListener("click", (event) => this.hide(event));
                });
            }

            toggle(event) {
                const button = event.currentTarget;
                const panelId = button.getAttribute("data-id");
                const panel = document.querySelector(`.overlay-panel[data-id='${panelId}']`);

                if (panel.classList.contains("active")) {
                    panel.classList.remove("active");
                } else {
                    this.show(button, panel);
                }
            }

            show(button, panel) {
                const rect = button.getBoundingClientRect();
                const panelRect = panel.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;

                let top, left;

                // Check available space
                const spaceAbove = rect.top;
                const spaceBelow = windowHeight - rect.bottom;
                const spaceLeft = rect.left;
                const spaceRight = windowWidth - rect.right;

                // Determine best position
                if (spaceBelow >= panelRect.height) {
                    // ✅ Place below button (default)
                    top = rect.bottom + window.scrollY;
                    left = this.alignHorizontally(rect, panelRect, windowWidth);
                } else if (spaceAbove >= panelRect.height) {
                    // ✅ Place above button
                    top = rect.top - panelRect.height + window.scrollY;
                    left = this.alignHorizontally(rect, panelRect, windowWidth);
                } else if (spaceRight >= panelRect.width) {
                    // ✅ Place to the right
                    top = this.alignVertically(rect, panelRect, windowHeight);
                    left = rect.right + window.scrollX;
                } else if (spaceLeft >= panelRect.width) {
                    // ✅ Place to the left
                    top = this.alignVertically(rect, panelRect, windowHeight);
                    left = rect.left - panelRect.width + window.scrollX;
                } else {
                    // ❗ Default positioning fallback (below, aligned left)
                    top = rect.bottom + window.scrollY;
                    left = rect.left + window.scrollX;
                }

                // Ensure panel stays inside viewport
                if (left + panelRect.width > windowWidth) {
                    left = windowWidth - panelRect.width - 10;
                }
                if (top + panelRect.height > windowHeight) {
                    top = windowHeight - panelRect.height - 10;
                }
                if (left < 0) left = 10;
                if (top < 0) top = 10;

                panel.style.top = `${top}px`;
                panel.style.left = `${left}px`;
                panel.classList.add("active");
            }

            alignHorizontally(rect, panelRect, windowWidth) {
                // Align left if there's space, otherwise align right
                if (rect.left + panelRect.width <= windowWidth) {
                    return rect.left + window.scrollX;
                } else {
                    return rect.right - panelRect.width + window.scrollX;
                }
            }

            alignVertically(rect, panelRect, windowHeight) {
                // Align top if there's space, otherwise align bottom
                if (rect.top + panelRect.height <= windowHeight) {
                    return rect.top + window.scrollY;
                } else {
                    return rect.bottom - panelRect.height + window.scrollY;
                }
            }

            hide(event) {
                const panel = event.target.closest(".overlay-panel");
                panel.classList.remove("active");
            }

            handleClickOutside(event) {
                if (!event.target.closest(".overlay-panel") && !event.target.closest(".triggerBtn")) {
                    this.panels.forEach(panel => panel.classList.remove("active"));
                }
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            new OverlayPanel();
        });
    </script>

</body>

</html>